#!/usr/bin/perl -w

#Automagically generated from SMSSplitter scripts
#Credits goes to Aleph0 Edition! http://www.aleph0.f2s.com for the original
#implementation as a SMSsplitter script
#Simply reimplemented by Giulio Motta

package WWW::SMS::GoldenTelecom;

require Exporter;
@ISA = qw(Exporter);
@EXPORT = qw();
@EXPORT_OK = qw(@PREFIXES _send MAXLENGTH);
undef @PREFIXES;
$VERSION = '1.00';

sub MAXLENGTH ()	{160}

sub _send {
	my $self = shift;

	use HTTP::Request::Common qw(GET POST);
	use HTTP::Cookies;
	use LWP::UserAgent;

	$ua = LWP::UserAgent->new;
	$ua->agent('Mozilla/5.0');
	$ua->cookie_jar(HTTP::Cookies->new(file => "lwpcookies.txt", autosave => 1));

	$self->{smstext} = substr($self->{smstext}, 0, MAXLENGTH - 1) if (length($self->{smstext})>MAXLENGTH);

	$req = POST 'http://sms.gt.com.ua:8080/SendSM.htm',
		[
		'SM' => $self->{smstext} ,
		'num' => (MAXLENGTH - length($self->{smstext})) ,
		'MN' => '+' . $self->{intpref} . $self->{prefix} . $self->{telnum} ,
		'CS' => 'S' ,
		];
	$req->headers->referer('http://sms.gt.com.ua/index.htm');
	print "1...";
	$file = $ua->simple_request($req)->as_string;
	return 0 unless ($file =~ /Message\ sent/s);
	$ua->cookie_jar->clear();
	1;
}

1;
